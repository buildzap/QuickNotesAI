<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Multilingual Voice - QuickNotes AI</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/task.css" rel="stylesheet">
    <link href="css/theme.css" rel="stylesheet">
    
    <style>
        .test-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .test-section {
            background: var(--background-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }
        
        .test-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .status-info { background-color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="text-center mb-4">
            <h1><i class="fas fa-globe-americas text-primary me-2"></i>Multilingual Voice Test</h1>
            <p class="text-muted">Testing the multilingual voice-to-task feature</p>
        </div>

        <!-- Test Results Section -->
        <div class="test-section">
            <h3 class="test-title">Test Results</h3>
            <div id="testResults">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Click "Run Tests" to start testing the multilingual voice feature
                </div>
            </div>
            <button class="btn btn-primary" onclick="runTests()">
                <i class="fas fa-play me-2"></i>Run Tests
            </button>
        </div>

        <!-- Feature Status Section -->
        <div class="test-section">
            <h3 class="test-title">Feature Status</h3>
            <div id="featureStatus">
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-2">
                            <span class="status-indicator status-info"></span>
                            <span>Speech Recognition Support</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <span class="status-indicator status-info"></span>
                            <span>User Authentication</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <span class="status-indicator status-info"></span>
                            <span>Premium Role Check</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-2">
                            <span class="status-indicator status-info"></span>
                            <span>Language Selector</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <span class="status-indicator status-info"></span>
                            <span>Voice Recording</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <span class="status-indicator status-info"></span>
                            <span>Task Creation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manual Test Section -->
        <div class="test-section">
            <h3 class="test-title">Manual Test</h3>
            <div class="row">
                <div class="col-md-6">
                    <label for="testLanguage" class="form-label">Select Language:</label>
                    <select class="form-select" id="testLanguage">
                        <option value="en-US">ðŸ‡ºðŸ‡¸ English (US)</option>
                        <option value="es-ES">ðŸ‡ªðŸ‡¸ Spanish (Spain)</option>
                        <option value="fr-FR">ðŸ‡«ðŸ‡· French (France)</option>
                        <option value="de-DE">ðŸ‡©ðŸ‡ª German (Germany)</option>
                        <option value="hi-IN">ðŸ‡®ðŸ‡³ Hindi (India)</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Test Voice Recording:</label>
                    <div class="d-grid">
                        <button class="btn btn-success" id="testVoiceBtn" onclick="testVoiceRecording()">
                            <i class="bi bi-mic-fill me-2"></i>Start Recording
                        </button>
                    </div>
                </div>
            </div>
            <div class="mt-3">
                <label class="form-label">Transcription Result:</label>
                <textarea class="form-control" id="testTranscript" rows="3" readonly placeholder="Transcription will appear here..."></textarea>
            </div>
        </div>

        <!-- Instructions Section -->
        <div class="test-section">
            <h3 class="test-title">Testing Instructions</h3>
            <div class="alert alert-warning">
                <h6><i class="fas fa-exclamation-triangle me-2"></i>Important Notes:</h6>
                <ul class="mb-0">
                    <li>This test requires microphone permissions</li>
                    <li>Works best in Google Chrome browser</li>
                    <li>User must be logged in to test premium features</li>
                    <li>Premium role is required for full functionality</li>
                </ul>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h6>For Premium Users:</h6>
                    <ol>
                        <li>Log in with a premium account</li>
                        <li>Navigate to the task page</li>
                        <li>Select your preferred language</li>
                        <li>Click the microphone button</li>
                        <li>Speak your task in the selected language</li>
                        <li>Review and save the transcribed task</li>
                    </ol>
                </div>
                <div class="col-md-6">
                    <h6>For Free Users:</h6>
                    <ol>
                        <li>Log in with a free account</li>
                        <li>Navigate to the task page</li>
                        <li>You should see an upgrade prompt</li>
                        <li>Premium features will be locked</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase.js"></script>
    <script src="js/task.js"></script>
    
    <script>
        let testRecognition = null;
        let isRecording = false;

        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin me-2"></i>Running tests...</div>';
            
            const tests = [
                { name: 'Speech Recognition Support', test: testSpeechRecognition },
                { name: 'User Authentication', test: testAuthentication },
                { name: 'Premium Role Check', test: testPremiumRole },
                { name: 'Language Selector', test: testLanguageSelector },
                { name: 'UI Elements', test: testUIElements }
            ];
            
            let passed = 0;
            let total = tests.length;
            
            Promise.all(tests.map(async (test) => {
                try {
                    const result = await test.test();
                    return { name: test.name, success: true, message: result };
                } catch (error) {
                    return { name: test.name, success: false, message: error.message };
                }
            })).then((results) => {
                let html = '<div class="alert alert-success"><h6><i class="fas fa-check-circle me-2"></i>Test Results:</h6><ul class="mb-0">';
                
                results.forEach(result => {
                    const icon = result.success ? 'fas fa-check text-success' : 'fas fa-times text-danger';
                    html += `<li><i class="${icon} me-2"></i>${result.name}: ${result.message}</li>`;
                    if (result.success) passed++;
                });
                
                html += '</ul></div>';
                
                const summary = passed === total ? 
                    `<div class="alert alert-success"><i class="fas fa-trophy me-2"></i>All tests passed! (${passed}/${total})</div>` :
                    `<div class="alert alert-warning"><i class="fas fa-exclamation-triangle me-2"></i>Some tests failed. (${passed}/${total})</div>`;
                
                results.innerHTML = summary + html;
                updateFeatureStatus(results);
            });
        }

        function testSpeechRecognition() {
            const supported = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
            if (!supported) {
                throw new Error('Speech recognition not supported in this browser');
            }
            return 'Speech recognition is supported';
        }

        function testAuthentication() {
            if (!window.firebaseAuth || !window.firebaseAuth.currentUser) {
                throw new Error('User not authenticated');
            }
            return 'User is authenticated';
        }

        async function testPremiumRole() {
            if (!window.firebaseAuth || !window.firebaseAuth.currentUser) {
                throw new Error('User not authenticated');
            }
            
            const user = window.firebaseAuth.currentUser;
            const userDoc = await window.firebaseDb.collection('users').doc(user.uid).get();
            const role = userDoc.exists ? userDoc.data().role || 'free' : 'free';
            
            if (role !== 'premium') {
                return `User role is '${role}' (premium required for full functionality)`;
            }
            return 'User has premium role';
        }

        function testLanguageSelector() {
            const selector = document.getElementById('testLanguage');
            if (!selector) {
                throw new Error('Language selector not found');
            }
            return `Language selector found with ${selector.options.length} options`;
        }

        function testUIElements() {
            const elements = [
                'multilingualVoiceSection',
                'voiceUpgradePrompt',
                'voiceLanguage',
                'multilingualVoiceBtn'
            ];
            
            const missing = elements.filter(id => !document.getElementById(id));
            if (missing.length > 0) {
                throw new Error(`Missing UI elements: ${missing.join(', ')}`);
            }
            return 'All UI elements found';
        }

        function updateFeatureStatus(testResults) {
            const statusElements = document.querySelectorAll('.status-indicator');
            statusElements.forEach((element, index) => {
                const result = testResults[index];
                element.className = `status-indicator ${result.success ? 'status-success' : 'status-error'}`;
            });
        }

        function testVoiceRecording() {
            const btn = document.getElementById('testVoiceBtn');
            const transcript = document.getElementById('testTranscript');
            
            if (!testRecognition) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                testRecognition = new SpeechRecognition();
                testRecognition.continuous = false;
                testRecognition.interimResults = true;
                testRecognition.lang = document.getElementById('testLanguage').value;
                
                testRecognition.onstart = () => {
                    isRecording = true;
                    btn.innerHTML = '<i class="bi bi-stop-fill me-2"></i>Stop Recording';
                    btn.className = 'btn btn-danger';
                    transcript.value = 'Listening...';
                };
                
                testRecognition.onresult = (event) => {
                    let finalTranscript = '';
                    let interimTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    
                    document.getElementById('testTranscript').value = finalTranscript || interimTranscript;
                };
                
                testRecognition.onend = () => {
                    isRecording = false;
                    btn.innerHTML = '<i class="bi bi-mic-fill me-2"></i>Start Recording';
                    btn.className = 'btn btn-success';
                };
                
                testRecognition.onerror = (event) => {
                    isRecording = false;
                    btn.innerHTML = '<i class="bi bi-mic-fill me-2"></i>Start Recording';
                    btn.className = 'btn btn-success';
                    transcript.value = `Error: ${event.error}`;
                };
            }
            
            if (isRecording) {
                testRecognition.stop();
            } else {
                testRecognition.lang = document.getElementById('testLanguage').value;
                testRecognition.start();
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[Test] Multilingual voice test page loaded');
            
            // Wait for Firebase to be ready
            if (window.firebaseInitialized) {
                window.firebaseInitialized.then(() => {
                    console.log('[Test] Firebase ready, running initial tests...');
                    setTimeout(runTests, 1000);
                });
            }
        });
    </script>
</body>
</html> 